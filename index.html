<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XGPVRTV36D"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XGPVRTV36D');
</script>
<!-- End Google Analytics -->

  
  <title>Ji Zhang&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Ji Zhang&#39;s Blog">
<meta property="og:url" content="https://shzhangji.com/index.html">
<meta property="og:site_name" content="Ji Zhang&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Ji Zhang (Jerry)">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@zjerryj">
  
    <link rel="alternate" href="/atom.xml" title="Ji Zhang's Blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

  
<meta name="generator" content="Hexo 7.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Ji Zhang&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">If I rest, I rust.</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/categories/Big-Data">Big Data</a>
        
          <a class="main-nav-link" href="/categories/Programming">Programming</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          
            <a class="nav-icon" target="_blank" rel="noopener" href="https://github.com/jizhang"><span class="fa fa-github"></span></a>
          
            <a class="nav-icon" target="_blank" rel="noopener" href="https://twitter.com/zjerryj"><span class="fa fa-twitter"></span></a>
          
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://shzhangji.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-dependency-injection-in-flink" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2024/02/07/dependency-injection-in-flink/" class="article-date">
  <time class="dt-published" datetime="2024-02-07T05:28:41.000Z" itemprop="datePublished">2024-02-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Big-Data/">Big Data</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/02/07/dependency-injection-in-flink/">Dependency Injection in Flink</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><p>Compose dependency graph with <a target="_blank" rel="noopener" href="https://github.com/google/guice">Guice</a>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DatabaseModule</span> <span class="keyword">extends</span> <span class="title class_">AbstractModule</span> &#123;</span><br><span class="line">  <span class="meta">@Provides</span> <span class="meta">@Singleton</span></span><br><span class="line">  <span class="keyword">public</span> DataSource <span class="title function_">provideDataSource</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HikariDataSource</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Provides</span> <span class="meta">@Singleton</span></span><br><span class="line">  <span class="keyword">public</span> UserRepository <span class="title function_">provideUserRepository</span><span class="params">(DataSource dataSource)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserRepositoryImpl</span>(dataSource);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Create singleton injector:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppInjector</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Holder</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Injector</span> <span class="variable">INJECTOR</span> <span class="operator">=</span> Guice.createInjector(<span class="keyword">new</span> <span class="title class_">DatabaseModule</span>());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">AppInjector</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">injectMembers</span><span class="params">(Object instance)</span> &#123;</span><br><span class="line">    Holder.INJECTOR.injectMembers(instance);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Use in Flink function:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">RichMapFunction</span>&lt;Long, User&gt; &#123;</span><br><span class="line">  <span class="meta">@Inject</span></span><br><span class="line">  <span class="keyword">transient</span> UserRepository userRepository;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">open</span><span class="params">(Configuration parameters)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    AppInjector.injectMembers(<span class="built_in">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> User <span class="title function_">map</span><span class="params">(Long userId)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    Objects.requireNonNull(userId, <span class="string">&quot;User ID is null&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> userRepository.getById(userId).orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;User not found&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="Motivation"><a href="#Motivation" class="headerlink" title="Motivation"></a>Motivation</h2><p>Dependency injection, or DI, is a common practice in Java programming, especially when you come from a Spring background. The most direct benefit is testability, meaning you can replace class implementation with test stub. Other benefits are separation of concerns, better class hierarchy, inversion of control, etc. Component defines its dependencies via class constructor or annotated members, and the DI framework creates a container, or context, to wire these components properly. This context is usually created at startup and lives through the application lifecycle. Some examples are Spring <code>ApplicationContext</code>, Guice <code>Injector</code>.</p>
<p>Flink is a distributed computing framework, and it is favorable to decouple business logic from it by dependency injection. However, Flink application is composed of functional classes, that are instantiated in driver class, or <code>main</code> method, serialized and sent to distributed task managers. We cannot inject dependencies into these classes unless all our components are serializable. Fortunately, Flink provides a lifecycle hook <code>open</code> that is called when the job starts. Combined with another common pattern, Singleton, we can make DI framework play well with Flink.</p>
        
          <p class="article-more-link">
            <a href="/blog/2024/02/07/dependency-injection-in-flink/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://shzhangji.com/blog/2024/02/07/dependency-injection-in-flink/" data-id="clu6m33kt00a0msq5hdsy8c9b" data-title="Dependency Injection in Flink" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
        <a href="https://shzhangji.com/blog/2024/02/07/dependency-injection-in-flink/#disqus_thread" class="article-comment-link"><span class="fa fa-comment">Comments</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/flink/" rel="tag">flink</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/guice/" rel="tag">guice</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-define-api-data-models-with-pydantic" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2024/01/28/define-api-data-models-with-pydantic/" class="article-date">
  <time class="dt-published" datetime="2024-01-28T09:53:28.000Z" itemprop="datePublished">2024-01-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming/">Programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/01/28/define-api-data-models-with-pydantic/">Define API Data Models with Pydantic</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>In modern architecture, frontend and backend are separated and maintained by different teams. To cooperate, backend exposes services as API endpoints with carefully designed data models, for both request and response. In Python, there are numerous ways to complete this task, such as WTForms, marshmallow. There are also frameworks that are designed to build API server, like FastAPI, Connexion, both are built around OpenAPI specification. In this article, I will introduce <a target="_blank" rel="noopener" href="https://pydantic.dev/">Pydantic</a>, a validation and serialization library for Python, to build and enforce API request and response models. The web framework I choose is Flask, but Pydantic is framework-agnostic and can also be used in non-web applications.</p>
<p><img src="/images/api-pydantic/pydantic.png" alt="Pydantic"></p>
<h2 id="Define-response-model"><a href="#Define-response-model" class="headerlink" title="Define response model"></a>Define response model</h2><p>After <code>pip install pydantic</code>, let‚Äôs define a simple response model to return the currently logged-in user:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="built_in">id</span>: <span class="built_in">int</span></span><br><span class="line">    username: <span class="built_in">str</span></span><br><span class="line">    last_login: datetime</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&#x27;/current-user&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">current_user</span>() -&gt; <span class="built_in">dict</span>:</span><br><span class="line">    user = User(<span class="built_in">id</span>=<span class="number">1</span>, username=<span class="string">&#x27;jizhang&#x27;</span>, last_login=datetime.now())</span><br><span class="line">    <span class="keyword">return</span> user.model_dump(mode=<span class="string">&#x27;json&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>Then use <a target="_blank" rel="noopener" href="https://httpie.io/">httpie</a> to test the API:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">% http localhost:5000/current-user</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;id&quot;: 1,</span><br><span class="line">    &quot;username&quot;: &quot;jizhang&quot;,</span><br><span class="line">    &quot;last_login&quot;: &quot;2024-01-25T10:25:23.670431&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>We create Pydantic model by extending <code>BaseModel</code>, which is the basic approach. There are others ways like <code>dataclass</code>, <code>TypeAdapter</code>, or dynamic creation of models.</li>
<li>Model fields are simply defined by class attributes and type annotations. Unlike other SerDe libraries, Pydantic is natively built with Python type hints. If you are not familiar with it, please check out my previous <a href="https://shzhangji.com/blog/2024/01/19/python-static-type-check/">blog post</a>.</li>
<li>In the API, we manually create a model instance <code>user</code>. Usually we create them from request body or database models, which will be demonstrated later.</li>
<li>Then we serialize, or ‚Äúdump‚Äù the model into a Python dict, that in turn is transformed by Flask into a JSON string. We can also use <code>user.model_dump_json()</code>, which returns the JSON string directly, but then the response header needs to be manually set to <code>application/json</code>, so we would rather let Flask do the job.</li>
<li><code>mode=&quot;json&quot;</code> tells Pydantic to serialize field values into JSON representable types. For instance, <code>datetime</code> and <code>Decimal</code> will be converted to string. Flask can also do this conversion, but we prefer keeping serialization in Pydantic model for clarity and ease of change.</li>
</ul>
        
          <p class="article-more-link">
            <a href="/blog/2024/01/28/define-api-data-models-with-pydantic/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://shzhangji.com/blog/2024/01/28/define-api-data-models-with-pydantic/" data-id="clu6m33ks009zmsq5d1sw6jz2" data-title="Define API Data Models with Pydantic" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
        <a href="https://shzhangji.com/blog/2024/01/28/define-api-data-models-with-pydantic/#disqus_thread" class="article-comment-link"><span class="fa fa-comment">Comments</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/flask/" rel="tag">flask</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openapi/" rel="tag">openapi</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pydantic/" rel="tag">pydantic</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-python-static-type-check" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2024/01/19/python-static-type-check/" class="article-date">
  <time class="dt-published" datetime="2024-01-19T12:27:56.000Z" itemprop="datePublished">2024-01-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming/">Programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/01/19/python-static-type-check/">Python Static Type Check</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Python is by design a dynamically typed programming language. It is flexible and easy to write. But as the project size grows, there will be more interactions between functions, classes and modules, and we often make mistakes like passing wrong types of arguments or assuming different return types from function calls. Worse still, these mistakes can only be spotted at runtime, and are likely to cause production bugs. Is it possible for Python to support static typing like Java and Go, checking errors at compile time, while remaining to be easy to use? Fortunately, from Python 3.5 on, it supports an optional syntax, or type hints, for static type check, and many tools are built around this feature. This article covers the following topics:</p>
<ul>
<li>A quick start to do static type check in Python.</li>
<li>Why do we need static typing?</li>
<li>Python type hints in detail.</li>
<li>Other advanced features.</li>
</ul>
<p><img src="/images/python-typing/mypy.png" alt="Mypy"></p>
<h2 id="Quick-start"><a href="#Quick-start" class="headerlink" title="Quick start"></a>Quick start</h2><p>Static typing can be achieved by adding type hints to function arguments and return value, while using a tool like <a target="_blank" rel="noopener" href="https://mypy-lang.org/">mypy</a> to do the check. For instance:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">greeting</span>(<span class="params">name: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello &#x27;</span> + name</span><br></pre></td></tr></table></figure>

<p>Here the function <code>greeting</code> accepts an argument which is typed as <code>str</code>, and its return value is also typed <code>str</code>. Run <code>pip install mypy</code>, and then check the file:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">% mypy quickstart.py</span><br><span class="line">Success: no issues found in 1 source file</span><br></pre></td></tr></table></figure>

<p>Clearly this simple function would pass the check. Let‚Äôs add some erroneous code:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">greeting</span>(<span class="params">name: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    real_name = name + <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello &#x27;</span> + real_name</span><br><span class="line"></span><br><span class="line">greeting(<span class="number">1</span>)</span><br><span class="line">greeting(<span class="string">&#x27;world&#x27;</span>) + <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>There will be plenty of errors found by mypy:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">% mypy quickstart.py</span><br><span class="line">quickstart.py:2: error: Unsupported operand types for + (&quot;str&quot; and &quot;int&quot;)  [operator]</span><br><span class="line">quickstart.py:5: error: Argument 1 to &quot;greeting&quot; has incompatible type &quot;int&quot;; expected &quot;str&quot;  [arg-type]</span><br><span class="line">quickstart.py:6: error: Unsupported operand types for + (&quot;str&quot; and &quot;int&quot;)  [operator]</span><br><span class="line">Found 3 errors in 1 file (checked 1 source file)</span><br></pre></td></tr></table></figure>

<p>The error messages are pretty clear. Usually we use pre-commit hook and CI to ensure everything checked into Git or merged into <code>master</code> passes <code>mypy</code>.</p>
        
          <p class="article-more-link">
            <a href="/blog/2024/01/19/python-static-type-check/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://shzhangji.com/blog/2024/01/19/python-static-type-check/" data-id="clu6m33jr003omsq5euymaqky" data-title="Python Static Type Check" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
        <a href="https://shzhangji.com/blog/2024/01/19/python-static-type-check/#disqus_thread" class="article-comment-link"><span class="fa fa-comment">Comments</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mypy/" rel="tag">mypy</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-migrate-from-pip-requirements-txt-to-poetry" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2024/01/05/migrate-from-pip-requirements-txt-to-poetry/" class="article-date">
  <time class="dt-published" datetime="2024-01-05T10:04:24.000Z" itemprop="datePublished">2024-01-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming/">Programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/01/05/migrate-from-pip-requirements-txt-to-poetry/">Migrate from Pip requirements.txt to Poetry</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Dependency management is a critical part of project development. If it were done wrong, project would behave differently between development and production environments. With Python, we have the tool <code>virtualenv</code> that isolates the project‚Äôs environment from the system‚Äôs, and we use <code>pip</code> and a <code>requirement.txt</code> file to maintain the list of dependencies. For instance:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Flask==3.0.0</span><br><span class="line">Flask-SQLAlchemy==3.1.1</span><br><span class="line">-e .</span><br></pre></td></tr></table></figure>

<p>And the environment can be setup by:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">% python3 -m venv venv</span><br><span class="line">% source venv/bin/activate</span><br><span class="line">(venv) % pip install -r requirements.txt</span><br></pre></td></tr></table></figure>


<h2 id="Disadvantages-of-the-requirements-txt-approach"><a href="#Disadvantages-of-the-requirements-txt-approach" class="headerlink" title="Disadvantages of the requirements.txt approach"></a>Disadvantages of the <code>requirements.txt</code> approach</h2><p>There are several shortcomings of this method. First and the major problem is this file only contains the <em>direct</em> dependencies, not the transitive ones. <code>pip freeze</code> shows that Flask and Flask-SQLAlchemy depend on several other packages:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">% pip freeze</span><br><span class="line">Flask==3.0.0</span><br><span class="line">Werkzeug==3.0.1</span><br><span class="line">Jinja2==3.1.2</span><br><span class="line">Flask-SQLAlchemy==3.1.1</span><br><span class="line">SQLAlchemy==2.0.25</span><br><span class="line">-e git+ssh://git@github.com/jizhang/blog-demo@82e4b4c4c6e72ed44e0cce9ee45aca5abc4dc87b#egg=poetry_demo&amp;subdirectory=poetry-demo</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Take Werkzeug for an example. It is required by Flask, and its version is stated as <code>Werkzeug&gt;=3.0.0</code> in Flask‚Äôs <a target="_blank" rel="noopener" href="https://github.com/pallets/flask/blob/735a4701d6d5e848241e7d7535db898efb62d400/pyproject.toml#L23">project file</a>. This may cause a problem when Werkzeug bumps its version to 4.x and after a reinstallation of the project, it will download the latest version of Werkzeug and create a compatibility issue. Same thing may happen to Flask-SQLAlchemy since functions of SQLAlchemy may vary between major versions.</p>
<p>A possible solution is to freeze the dependencies altogether:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">% pip freeze &gt;requirements.txt</span><br></pre></td></tr></table></figure>

<p>This is practically the <em>lockfile</em> we see in other languages like <code>yarn.lock</code> and <code>Gemfile.lock</code>, whereby the installation process is fully reproducible. But for Python, we need extra effort to ensure that the <code>requirements.txt</code> is updated correctly after modifying the dependencies. And it also makes it difficult to upgrade the direct dependencies because the transitive ones need to be upgraded manually.</p>
        
          <p class="article-more-link">
            <a href="/blog/2024/01/05/migrate-from-pip-requirements-txt-to-poetry/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://shzhangji.com/blog/2024/01/05/migrate-from-pip-requirements-txt-to-poetry/" data-id="clu6m33jr003lmsq5c740eloh" data-title="Migrate from Pip requirements.txt to Poetry" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
        <a href="https://shzhangji.com/blog/2024/01/05/migrate-from-pip-requirements-txt-to-poetry/#disqus_thread" class="article-comment-link"><span class="fa fa-comment">Comments</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pip/" rel="tag">pip</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/poetry/" rel="tag">poetry</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-setup-ci-with-github-actions-java-node-python" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2023/02/13/setup-ci-with-github-actions-java-node-python/" class="article-date">
  <time class="dt-published" datetime="2023-02-13T10:36:12.000Z" itemprop="datePublished">2023-02-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming/">Programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2023/02/13/setup-ci-with-github-actions-java-node-python/">Setup CI with GitHub Actions (Java/Node/Python)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Continuous integration, or CI, is a great tool to maintain a healthy code base. As in <a target="_blank" rel="noopener" href="https://github.com/okonet/lint-staged">lint-staged</a>‚Äòs motto, ‚Äúdon‚Äôt let üí© slip into your code base‚Äù, CI can run various checks to prevent compilation error, unit test failure, or violation of code style from being merged into the main branch. Besides, CI can also do the packaging work, making artifacts that are ready to be deployed to production. In this article, I‚Äôll demonstrate how to use <a target="_blank" rel="noopener" href="https://docs.github.com/en/actions">GitHub Actions</a> to define CI workflow that checks and packages Java&#x2F;Node&#x2F;Python applications.</p>
<p><img src="/images/ci-with-github-actions.png" alt="CI with GitHub Actions"></p>
<h2 id="Run-Maven-verify-on-push"><a href="#Run-Maven-verify-on-push" class="headerlink" title="Run Maven verify on push"></a>Run Maven verify on push</h2><p>CI typically has two phases, one is during development and before merging into the master, the other is right after the feature branch is merged. Former only requires checking the code, i.e. build the newly pushed code in a branch, and see if there‚Äôs any violation or bug. After it‚Äôs merged, CI will run checking <em>and</em> packaging altogether, to produce a deployable artifact, usually a Docker image.</p>
<p>For Java project, we use JUnit, Checkstyle and SpotBugs as Maven plugins to run various checks whenever someone pushes to a feature branch. To do that with GitHub Actions, we need to create a workflow that includes setting up Java environment and running <code>mvn verify</code>. Here‚Äôs a minimum workflow definition in <code>project-root/.github/workflows/build.yml</code>:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Build</span></span><br><span class="line"><span class="attr">on:</span> <span class="string">push</span></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">verify:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v3</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/setup-java@v3</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">java-version:</span> <span class="string">&#x27;17&#x27;</span></span><br><span class="line">          <span class="attr">distribution:</span> <span class="string">temurin</span></span><br><span class="line">          <span class="attr">cache:</span> <span class="string">maven</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">run:</span> <span class="string">mvn</span> <span class="string">--batch-mode</span> <span class="string">verify</span></span><br></pre></td></tr></table></figure>
        
          <p class="article-more-link">
            <a href="/blog/2023/02/13/setup-ci-with-github-actions-java-node-python/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://shzhangji.com/blog/2023/02/13/setup-ci-with-github-actions-java-node-python/" data-id="clu6m33jq003imsq5dl6p65qi" data-title="Setup CI with GitHub Actions (Java/Node/Python)" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
        <a href="https://shzhangji.com/blog/2023/02/13/setup-ci-with-github-actions-java-node-python/#disqus_thread" class="article-comment-link"><span class="fa fa-comment">Comments</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ci/" rel="tag">ci</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/github/" rel="tag">github</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-restful-api-authentication-with-spring-security" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2023/01/15/restful-api-authentication-with-spring-security/" class="article-date">
  <time class="dt-published" datetime="2023-01-15T06:51:51.000Z" itemprop="datePublished">2023-01-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming/">Programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2023/01/15/restful-api-authentication-with-spring-security/">RESTful API Authentication with Spring Security</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>When it comes to implementing user authentication in RESTful API server, there‚Äôre several options like <a target="_blank" rel="noopener" href="https://spring.io/projects/spring-security">Spring Security</a>, <a target="_blank" rel="noopener" href="https://shiro.apache.org/">Apache Shiro</a>, or writing our own version of Filters and Servlets. If the server already uses <a target="_blank" rel="noopener" href="https://spring.io/projects/spring-boot">Spring Boot</a>, then Spring Security is really a good fit, for it integrates quite well with Spring Boot project, thanks to all those automatic configurations. However, Spring Security‚Äôs login facility is originally built for web forms or basic HTTP authentication, while modern apps usually lean on RESTful API. We can either adapt the frontend client to utilizing the built-in login methods as in this tutorial <a target="_blank" rel="noopener" href="https://spring.io/guides/tutorials/spring-security-and-angular-js/">Spring Security and Angular JS</a>, or write custom Filter to <a target="_blank" rel="noopener" href="https://ckinan.com/blog/spring-security-credentials-from-json-request/">extract user credentials from input JSON</a>.</p>
<p><img src="/images/spring-security.png" alt="Spring Security"></p>
<p>Having said that, personally I still prefer to maintain a consistent API style in user authentication, and I don‚Äôt want to write awkward logics with raw Servlet request&#x2F;response objects in Filter, instead of using what Spring MVC provides, i.e. <code>@RestController</code>, <code>@RequestBody</code>, form validation, etc. Luckily, Spring Security provides integration for Servlet API, so that we can login&#x2F;logout user within the Controller. In this article, I will demonstrate how to use Spring Security to guard your RESTful API server, with the following functions:</p>
<ul>
<li>Login&#x2F;logout with JSON API.</li>
<li>Return 401 for unauthenticated requests.</li>
<li>Custom table for user data.</li>
<li>CSRF protection.</li>
<li>Remember me.</li>
<li>Session persistence.</li>
</ul>
        
          <p class="article-more-link">
            <a href="/blog/2023/01/15/restful-api-authentication-with-spring-security/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://shzhangji.com/blog/2023/01/15/restful-api-authentication-with-spring-security/" data-id="clu6m33jq003gmsq5gklja7xr" data-title="RESTful API Authentication with Spring Security" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
        <a href="https://shzhangji.com/blog/2023/01/15/restful-api-authentication-with-spring-security/#disqus_thread" class="article-comment-link"><span class="fa fa-comment">Comments</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/restful/" rel="tag">restful</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spring-boot/" rel="tag">spring boot</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spring-security/" rel="tag">spring security</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-mock-api-in-parcel-project" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2023/01/09/mock-api-in-parcel-project/" class="article-date">
  <time class="dt-published" datetime="2023-01-09T06:53:40.000Z" itemprop="datePublished">2023-01-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming/">Programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2023/01/09/mock-api-in-parcel-project/">Mock API in Parcel Project</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>When developing a frontend application, usually we create mocks for backend API, so that after the API contract is settled down, front and backend engineers can work independently. There are several ways to accomplish this task, such as start a dedicated server and let the build tool serve as a proxy, or we can add middleware directly into the build tool‚Äôs dev server, if applicable. Some tools can monkey patch the network calls to replace the response with mock data, and various unit testing tools provide their own way of mocking. In this article, I will focus on how to add middleware into <a target="_blank" rel="noopener" href="https://parceljs.org/">Parcel</a>‚Äòs dev server to respond with mock data for API calls.</p>
<p><img src="/images/parcel.png" alt="Parcel"></p>
<h2 id="API-Proxy-in-Parcel‚Äôs-development-server"><a href="#API-Proxy-in-Parcel‚Äôs-development-server" class="headerlink" title="API Proxy in Parcel‚Äôs development server"></a>API Proxy in Parcel‚Äôs development server</h2><p>Parcel provides a dev server and supports <a target="_blank" rel="noopener" href="https://parceljs.org/features/development/#api-proxy">API proxy</a> out of the box. Under the hood, it uses <a target="_blank" rel="noopener" href="https://github.com/senchalabs/connect">connect</a> and <a target="_blank" rel="noopener" href="https://github.com/chimurai/http-proxy-middleware">http-proxy-middleware</a> to redirect API calls to a different server. It also provides the ability to customize the proxy behavior. For instance, by creating a file named <code>.proxyrc.js</code> in project‚Äôs root, we can manually redirect all API calls to a mock server listening on <code>localhost:8080</code>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; createProxyMiddleware &#125; = <span class="built_in">require</span>(<span class="string">&#x27;http-proxy-middleware&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> (<span class="params">app</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> proxy = <span class="title function_">createProxyMiddleware</span>(<span class="string">&#x27;/api&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">target</span>: <span class="string">&#x27;http://localhost:8080/&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  app.<span class="title function_">use</span>(proxy)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In order to serve API calls directly in Parcel‚Äôs dev server, we just need to write our own middleware and wire it into the <code>connect</code> instance. Let‚Äôs name it <code>mock-middleware</code>, and it has the following functions:</p>
<ul>
<li>Read source files from the <code>/mock</code> folder, and serve API calls with mock data.</li>
<li>When the files are updated, refresh the APIs as well.</li>
</ul>
        
          <p class="article-more-link">
            <a href="/blog/2023/01/09/mock-api-in-parcel-project/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://shzhangji.com/blog/2023/01/09/mock-api-in-parcel-project/" data-id="clu6m33jp003dmsq5dajq3tjl" data-title="Mock API in Parcel Project" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
        <a href="https://shzhangji.com/blog/2023/01/09/mock-api-in-parcel-project/#disqus_thread" class="article-comment-link"><span class="fa fa-comment">Comments</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/connect/" rel="tag">connect</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/frontend/" rel="tag">frontend</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/parcel/" rel="tag">parcel</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-configure-git-line-endings-across-oses" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2022/08/31/configure-git-line-endings-across-oses/" class="article-date">
  <time class="dt-published" datetime="2022-08-31T07:23:43.000Z" itemprop="datePublished">2022-08-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming/">Programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2022/08/31/configure-git-line-endings-across-oses/">Configure Git Line Endings Across OSes</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>In Linux, lines end with LF (Line Feed, <code>\n</code>), while in Windows, CRLF (Carriage Return + Line Feed, <code>\r\n</code>). When developers using different operating systems contribute to the same Git project, line endings must be handled correctly, or <code>diff</code> and <code>merge</code> may break unexpectedly. Git provides several solutions to this problem, including configuration options and file attributes.</p>
<h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><h3 id="Approach-1"><a href="#Approach-1" class="headerlink" title="Approach 1"></a>Approach 1</h3><p>Set <code>core.autocrlf</code> to <code>input</code> in <strong>Windows</strong>. Leave Linux&#x2F;macOS unchanged.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global core.autocrlf input</span><br></pre></td></tr></table></figure>

<h3 id="Approach-2"><a href="#Approach-2" class="headerlink" title="Approach 2"></a>Approach 2</h3><p>Create <code>.gitattributes</code> under the project root, and add the following line:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* text=auto eol=lf</span><br></pre></td></tr></table></figure>
        
          <p class="article-more-link">
            <a href="/blog/2022/08/31/configure-git-line-endings-across-oses/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://shzhangji.com/blog/2022/08/31/configure-git-line-endings-across-oses/" data-id="clu6m33jo003amsq56vxr4vzm" data-title="Configure Git Line Endings Across OSes" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
        <a href="https://shzhangji.com/blog/2022/08/31/configure-git-line-endings-across-oses/#disqus_thread" class="article-comment-link"><span class="fa fa-comment">Comments</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/" rel="tag">git</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-configure-logging-for-flask-sqlalchemy-project" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2022/08/10/configure-logging-for-flask-sqlalchemy-project/" class="article-date">
  <time class="dt-published" datetime="2022-08-10T02:56:07.000Z" itemprop="datePublished">2022-08-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming/">Programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2022/08/10/configure-logging-for-flask-sqlalchemy-project/">Configure Logging for Flask SQLAlchemy Project</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>In Python, the built-in <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/logging.html"><code>logging</code></a> module is the standard way of doing application logs, and most third-party libraries integrate well with it. For instance, <a target="_blank" rel="noopener" href="https://flask.palletsprojects.com/en/2.1.x/logging/">Flask</a> creates a default <code>app.logger</code> with a <code>StreamHandler</code> that writes to standard error. <a target="_blank" rel="noopener" href="https://docs.sqlalchemy.org/en/14/core/engines.html#configuring-logging">SQLAlchemy</a> uses a logger named <code>sqlalchemy</code> and allow us to further customize its behaviour. This article shows how to configure logging for Flask and SQLAlchemy, both in debug mode and production mode.</p>
<h2 id="Default-logging-behaviour-of-Flask"><a href="#Default-logging-behaviour-of-Flask" class="headerlink" title="Default logging behaviour of Flask"></a>Default logging behaviour of Flask</h2><p>According to Flask document, when the <code>app.logger</code> property is accessed for the first time, it creates a logger with the name of the application, usually the module name you used in <code>app = Flask(__name__)</code>. The logging level is set to <code>DEBUG</code> if current application is in debug mode, or <code>NOTSET</code> and lets parent loggers decide the level. Then it checks if a log handler has already been added to the logger or any parent loggers, otherwise it adds a default one. The log format is as follows:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logging.Formatter(<span class="string">&quot;[%(asctime)s] %(levelname)s in %(module)s: %(message)s&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>In application, we can invoke the logging methods on <code>app.logger</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_logging <span class="keyword">import</span> app  <span class="comment"># flask_logging is the project name</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Invoke in flask_logging.views.user module.</span></span><br><span class="line">app.logger.info(<span class="string">&#x27;Get user list&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>The output is:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[2022-08-08 18:33:11,451] INFO in user: Get user list</span><br></pre></td></tr></table></figure>

<p>In production, the root logger is set to <code>WARNING</code> level by default, so only warning, error, and critical messages will be logged.</p>
        
          <p class="article-more-link">
            <a href="/blog/2022/08/10/configure-logging-for-flask-sqlalchemy-project/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://shzhangji.com/blog/2022/08/10/configure-logging-for-flask-sqlalchemy-project/" data-id="clu6m33jn0036msq567275zti" data-title="Configure Logging for Flask SQLAlchemy Project" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
        <a href="https://shzhangji.com/blog/2022/08/10/configure-logging-for-flask-sqlalchemy-project/#disqus_thread" class="article-comment-link"><span class="fa fa-comment">Comments</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/flask/" rel="tag">flask</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sqlalchemy/" rel="tag">sqlalchemy</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-use-composition-api-and-pinia-in-vue-2-project" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2022/07/31/use-composition-api-and-pinia-in-vue-2-project/" class="article-date">
  <time class="dt-published" datetime="2022-07-31T06:07:27.000Z" itemprop="datePublished">2022-07-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming/">Programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2022/07/31/use-composition-api-and-pinia-in-vue-2-project/">Use Composition API and Pinia in Vue 2 Project</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Composition API is one of the major features of Vue 3, and it greatly changes how we organize code. Vue 3 also introduces Pinia as the recommended state management library, superceding Vuex that now enters maintenance mode. It would be nice if we can use these cool features in Vue 2 project, since migration of legacy project could be difficult and costly. Fortunately, the community has tried hard to bring Vue 3 features back to Vue 2, like <a target="_blank" rel="noopener" href="https://github.com/vuejs/composition-api"><code>@vue/composition-api</code></a>, <a target="_blank" rel="noopener" href="https://github.com/antfu/unplugin-vue2-script-setup"><code>unplugin-vue2-script-setup</code></a> and <a target="_blank" rel="noopener" href="https://github.com/vueuse/vue-demi"><code>vue-demi</code></a>. Recently, <a target="_blank" rel="noopener" href="https://blog.vuejs.org/posts/vue-2-7-naruto.html">Vue 2.7</a> is released and backports features like Composition API, <code>&lt;script setup&gt;</code>, <code>defineComponent</code>, etc. This article will show you how to change your code from Options API to Composition API, from Vuex to Pinia.</p>
<h2 id="Why-Composition-API"><a href="#Why-Composition-API" class="headerlink" title="Why Composition API"></a>Why Composition API</h2><p>The main advantage of Composition API is that you can organize your code in a more flexible way. Previously with Options API, we can only group codes by <code>data</code>, <code>methods</code>, and hooks, while with Composition API, codes constituting one feature can be put together. There is a nice figure in the official document <em><a target="_blank" rel="noopener" href="https://vuejs.org/guide/extras/composition-api-faq.html">Composition API FAQ</a></em> that illustrates how code blocks look differently after applying Composition API.</p>
<p><img src="/images/typescript/composition-api-after.png" alt="Options API vs. Composition API"></p>
        
          <p class="article-more-link">
            <a href="/blog/2022/07/31/use-composition-api-and-pinia-in-vue-2-project/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://shzhangji.com/blog/2022/07/31/use-composition-api-and-pinia-in-vue-2-project/" data-id="clu6m33jm0033msq5cgufhgv3" data-title="Use Composition API and Pinia in Vue 2 Project" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
        <a href="https://shzhangji.com/blog/2022/07/31/use-composition-api-and-pinia-in-vue-2-project/#disqus_thread" class="article-comment-link"><span class="fa fa-comment">Comments</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/frontend/" rel="tag">frontend</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pinia/" rel="tag">pinia</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/typescript/" rel="tag">typescript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue/" rel="tag">vue</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/algorithm/" style="font-size: 10px;">algorithm</a> <a href="/tags/analytics/" style="font-size: 14.29px;">analytics</a> <a href="/tags/apache-beam/" style="font-size: 10px;">apache beam</a> <a href="/tags/bootstrap/" style="font-size: 10px;">bootstrap</a> <a href="/tags/canal/" style="font-size: 10px;">canal</a> <a href="/tags/ci/" style="font-size: 10px;">ci</a> <a href="/tags/clojure/" style="font-size: 10px;">clojure</a> <a href="/tags/connect/" style="font-size: 10px;">connect</a> <a href="/tags/crossfilter/" style="font-size: 10px;">crossfilter</a> <a href="/tags/dc-js/" style="font-size: 10px;">dc.js</a> <a href="/tags/devops/" style="font-size: 10px;">devops</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/eclipse/" style="font-size: 10px;">eclipse</a> <a href="/tags/elasticsearch/" style="font-size: 10px;">elasticsearch</a> <a href="/tags/es6/" style="font-size: 10px;">es6</a> <a href="/tags/eslint/" style="font-size: 11.43px;">eslint</a> <a href="/tags/etl/" style="font-size: 12.86px;">etl</a> <a href="/tags/flask/" style="font-size: 14.29px;">flask</a> <a href="/tags/flink/" style="font-size: 12.86px;">flink</a> <a href="/tags/flume/" style="font-size: 12.86px;">flume</a> <a href="/tags/frontend/" style="font-size: 17.14px;">frontend</a> <a href="/tags/functional-programming/" style="font-size: 10px;">functional programming</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/github/" style="font-size: 11.43px;">github</a> <a href="/tags/guice/" style="font-size: 10px;">guice</a> <a href="/tags/hadoop/" style="font-size: 10px;">hadoop</a> <a href="/tags/hbase/" style="font-size: 10px;">hbase</a> <a href="/tags/hdfs/" style="font-size: 11.43px;">hdfs</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/hive/" style="font-size: 11.43px;">hive</a> <a href="/tags/java/" style="font-size: 18.57px;">java</a> <a href="/tags/javascript/" style="font-size: 15.71px;">javascript</a> <a href="/tags/kafka/" style="font-size: 11.43px;">kafka</a> <a href="/tags/kubernetes/" style="font-size: 11.43px;">kubernetes</a> <a href="/tags/lodash/" style="font-size: 11.43px;">lodash</a> <a href="/tags/machine-learning/" style="font-size: 10px;">machine learning</a> <a href="/tags/mapreduce/" style="font-size: 10px;">mapreduce</a> <a href="/tags/mypy/" style="font-size: 10px;">mypy</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/openapi/" style="font-size: 11.43px;">openapi</a> <a href="/tags/ops/" style="font-size: 10px;">ops</a> <a href="/tags/pandas/" style="font-size: 11.43px;">pandas</a> <a href="/tags/parcel/" style="font-size: 10px;">parcel</a> <a href="/tags/pinia/" style="font-size: 10px;">pinia</a> <a href="/tags/pip/" style="font-size: 10px;">pip</a> <a href="/tags/poetry/" style="font-size: 10px;">poetry</a> <a href="/tags/prometheus/" style="font-size: 10px;">prometheus</a> <a href="/tags/pydantic/" style="font-size: 10px;">pydantic</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/react/" style="font-size: 10px;">react</a> <a href="/tags/restful/" style="font-size: 11.43px;">restful</a> <a href="/tags/scala/" style="font-size: 11.43px;">scala</a> <a href="/tags/scalatra/" style="font-size: 10px;">scalatra</a> <a href="/tags/source-code/" style="font-size: 10px;">source code</a> <a href="/tags/spark/" style="font-size: 14.29px;">spark</a> <a href="/tags/spark-streaming/" style="font-size: 10px;">spark streaming</a> <a href="/tags/spring/" style="font-size: 12.86px;">spring</a> <a href="/tags/spring-boot/" style="font-size: 11.43px;">spring boot</a> <a href="/tags/spring-security/" style="font-size: 10px;">spring security</a> <a href="/tags/sql/" style="font-size: 11.43px;">sql</a> <a href="/tags/sqlalchemy/" style="font-size: 11.43px;">sqlalchemy</a> <a href="/tags/stream-processing/" style="font-size: 12.86px;">stream processing</a> <a href="/tags/tensorflow/" style="font-size: 10px;">tensorflow</a> <a href="/tags/thrift/" style="font-size: 10px;">thrift</a> <a href="/tags/typescript/" style="font-size: 12.86px;">typescript</a> <a href="/tags/vite/" style="font-size: 10px;">vite</a> <a href="/tags/vue/" style="font-size: 15.71px;">vue</a> <a href="/tags/vuex/" style="font-size: 10px;">vuex</a> <a href="/tags/webjars/" style="font-size: 10px;">webjars</a> <a href="/tags/webpack/" style="font-size: 10px;">webpack</a> <a href="/tags/websocket/" style="font-size: 10px;">websocket</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">February 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">January 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">April 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">October 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">April 2013</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/2024/02/07/dependency-injection-in-flink/">Dependency Injection in Flink</a>
          </li>
        
          <li>
            <a href="/blog/2024/01/28/define-api-data-models-with-pydantic/">Define API Data Models with Pydantic</a>
          </li>
        
          <li>
            <a href="/blog/2024/01/19/python-static-type-check/">Python Static Type Check</a>
          </li>
        
          <li>
            <a href="/blog/2024/01/05/migrate-from-pip-requirements-txt-to-poetry/">Migrate from Pip requirements.txt to Poetry</a>
          </li>
        
          <li>
            <a href="/blog/2023/02/13/setup-ci-with-github-actions-java-node-python/">Setup CI with GitHub Actions (Java/Node/Python)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
        <p xmlns:cc="http://creativecommons.org/ns#" >This work is licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY-NC-SA 4.0<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nc.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1"></a></p>
      
      &copy; 2024 Ji Zhang (Jerry)<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/categories/Big-Data" class="mobile-nav-link">Big Data</a>
  
    <a href="/categories/Programming" class="mobile-nav-link">Programming</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'jizhang';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>



<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>