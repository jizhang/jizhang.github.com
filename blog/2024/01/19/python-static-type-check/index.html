<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XGPVRTV36D"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XGPVRTV36D');
</script>
<!-- End Google Analytics -->

  
  <title>Python Static Type Check | Ji Zhang&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Python is by design a dynamically typed programming language. It is flexible and easy to write. But as the project size grows, there will be more interactions between functions, classes and modules, a">
<meta property="og:type" content="article">
<meta property="og:title" content="Python Static Type Check">
<meta property="og:url" content="https://shzhangji.com/blog/2024/01/19/python-static-type-check/index.html">
<meta property="og:site_name" content="Ji Zhang&#39;s Blog">
<meta property="og:description" content="Python is by design a dynamically typed programming language. It is flexible and easy to write. But as the project size grows, there will be more interactions between functions, classes and modules, a">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://shzhangji.com/images/python-typing/mypy.png">
<meta property="og:image" content="https://shzhangji.com/images/python-typing/categories.png">
<meta property="og:image" content="https://shzhangji.com/images/python-typing/collection-types.png">
<meta property="article:published_time" content="2024-01-19T12:27:56.000Z">
<meta property="article:modified_time" content="2024-01-19T12:27:56.000Z">
<meta property="article:author" content="Ji Zhang (Jerry)">
<meta property="article:tag" content="python">
<meta property="article:tag" content="mypy">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://shzhangji.com/images/python-typing/mypy.png">
<meta name="twitter:creator" content="@zjerryj">
  
    <link rel="alternate" href="/atom.xml" title="Ji Zhang's Blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

  
<meta name="generator" content="Hexo 7.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Ji Zhang&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">If I rest, I rust.</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/categories/Big-Data">Big Data</a>
        
          <a class="main-nav-link" href="/categories/Programming">Programming</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          
            <a class="nav-icon" target="_blank" rel="noopener" href="https://github.com/jizhang"><span class="fa fa-github"></span></a>
          
            <a class="nav-icon" target="_blank" rel="noopener" href="https://twitter.com/zjerryj"><span class="fa fa-twitter"></span></a>
          
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://shzhangji.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-python-static-type-check" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2024/01/19/python-static-type-check/" class="article-date">
  <time class="dt-published" datetime="2024-01-19T12:27:56.000Z" itemprop="datePublished">2024-01-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming/">Programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      Python Static Type Check
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Python is by design a dynamically typed programming language. It is flexible and easy to write. But as the project size grows, there will be more interactions between functions, classes and modules, and we often make mistakes like passing wrong types of arguments or assuming different return types from function calls. Worse still, these mistakes can only be spotted at runtime, and are likely to cause production bugs. Is it possible for Python to support static typing like Java and Go, checking errors at compile time, while remaining to be easy to use? Fortunately, from Python 3.5 on, it supports an optional syntax, or type hints, for static type check, and many tools are built around this feature. This article covers the following topics:</p>
<ul>
<li>A quick start to do static type check in Python.</li>
<li>Why do we need static typing?</li>
<li>Python type hints in detail.</li>
<li>Other advanced features.</li>
</ul>
<p><img src="/images/python-typing/mypy.png" alt="Mypy"></p>
<h2 id="Quick-start"><a href="#Quick-start" class="headerlink" title="Quick start"></a>Quick start</h2><p>Static typing can be achieved by adding type hints to function arguments and return value, while using a tool like <a target="_blank" rel="noopener" href="https://mypy-lang.org/">mypy</a> to do the check. For instance:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">greeting</span>(<span class="params">name: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello &#x27;</span> + name</span><br></pre></td></tr></table></figure>

<p>Here the function <code>greeting</code> accepts an argument which is typed as <code>str</code>, and its return value is also typed <code>str</code>. Run <code>pip install mypy</code>, and then check the file:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">% mypy quickstart.py</span><br><span class="line">Success: no issues found in 1 source file</span><br></pre></td></tr></table></figure>

<p>Clearly this simple function would pass the check. Let’s add some erroneous code:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">greeting</span>(<span class="params">name: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    real_name = name + <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello &#x27;</span> + real_name</span><br><span class="line"></span><br><span class="line">greeting(<span class="number">1</span>)</span><br><span class="line">greeting(<span class="string">&#x27;world&#x27;</span>) + <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>There will be plenty of errors found by mypy:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">% mypy quickstart.py</span><br><span class="line">quickstart.py:2: error: Unsupported operand types for + (&quot;str&quot; and &quot;int&quot;)  [operator]</span><br><span class="line">quickstart.py:5: error: Argument 1 to &quot;greeting&quot; has incompatible type &quot;int&quot;; expected &quot;str&quot;  [arg-type]</span><br><span class="line">quickstart.py:6: error: Unsupported operand types for + (&quot;str&quot; and &quot;int&quot;)  [operator]</span><br><span class="line">Found 3 errors in 1 file (checked 1 source file)</span><br></pre></td></tr></table></figure>

<p>The error messages are pretty clear. Usually we use pre-commit hook and CI to ensure everything checked into Git or merged into <code>master</code> passes <code>mypy</code>.</p>
<span id="more"></span>

<p>Type hints can also be applied to local variables. But most of the time, <code>mypy</code> is able to <em>infer</em> the type from the value.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">greeting</span>(<span class="params">name: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    real_name = <span class="string">&#x27;hello &#x27;</span> + name</span><br><span class="line">    number: <span class="built_in">int</span> = real_name</span><br><span class="line">    <span class="keyword">return</span> number</span><br></pre></td></tr></table></figure>

<p><code>real_name</code> would be inferred as <code>str</code> type, so when it is assigned to <code>number</code>, an <code>int</code> typed variable, error occurs. The return value also includes an error.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">% mypy quickstart.py</span><br><span class="line">quickstart.py:3: error: Incompatible types in assignment (expression has type &quot;str&quot;, variable has type &quot;int&quot;)  [assignment]</span><br><span class="line">quickstart.py:4: error: Incompatible return value type (got &quot;int&quot;, expected &quot;str&quot;)  [return-value]</span><br><span class="line">Found 2 errors in 1 file (checked 1 source file)</span><br></pre></td></tr></table></figure>

<p>There are basic types like <code>str</code>, <code>int</code>, and collection types like <code>list</code>, <code>dict</code>. We can even define the type of their elements:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">items: <span class="built_in">list</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">nums: <span class="built_in">list</span>[<span class="built_in">int</span>] = []</span><br><span class="line">nums.append(<span class="string">&#x27;text&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ages: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="built_in">int</span>] = &#123;&#125;</span><br><span class="line">ages[<span class="string">&#x27;John&#x27;</span>] = <span class="string">&#x27;30&#x27;</span></span><br></pre></td></tr></table></figure>

<p>You may see some code written as <code>List[int]</code> or <code>Dict[str, int]</code>, where <code>List</code> is imported from the <code>typing</code> module. This is because before Python 3.9, <code>list</code> and other builtins do not support subscripting <code>[]</code>. This article’s examples are based on Python 3.10.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">% mypy quickstart.py</span><br><span class="line">quickstart.py:1: error: Incompatible types in assignment (expression has type &quot;int&quot;, variable has type &quot;list[Any]&quot;)  [assignment]</span><br><span class="line">quickstart.py:4: error: Argument 1 to &quot;append&quot; of &quot;list&quot; has incompatible type &quot;str&quot;; expected &quot;int&quot;  [arg-type]</span><br><span class="line">quickstart.py:7: error: Incompatible types in assignment (expression has type &quot;str&quot;, target has type &quot;int&quot;)  [assignment]</span><br><span class="line">Found 3 errors in 1 file (checked 1 source file)</span><br></pre></td></tr></table></figure>

<p>The check works as expected: <code>items</code> is a <code>list</code>, so it cannot be assigned otherwise; <code>nums</code> is a list of numbers, no string is allowed; the value of <code>ages</code> is also restricted. Look carefully at the first error message, we can see <code>list</code> is equivalent to <code>list[Any]</code>, where <code>Any</code> is also defined in <code>typing</code> module, which means literally any type. For instance, if a function argument is not given a type hint, it is defined as <code>Any</code> and can accept any type of value.</p>
<p>Please remember, these checks do not happen at runtime. Python remains to be a dynamically typed language. If you need runtime validation, extra tools are required. We will discuss it in a later section.</p>
<p>The last example is defining types for class members:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Job</span>:</span><br><span class="line">    suffix: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, date: <span class="built_in">str</span>, suffix: <span class="built_in">str</span></span>):</span><br><span class="line">        self.date = date</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.date + <span class="number">1</span></span><br><span class="line">        self.suffix + <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>Type hints could be applied either in class body or in constructor. Member functions are typed as normal.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">% mypy quickstart.py</span><br><span class="line">quickstart.py:8: error: Unsupported operand types for + (&quot;str&quot; and &quot;int&quot;)  [operator]</span><br><span class="line">quickstart.py:9: error: Unsupported operand types for + (&quot;str&quot; and &quot;int&quot;)  [operator]</span><br><span class="line">Found 2 errors in 1 file (checked 1 source file)</span><br></pre></td></tr></table></figure>


<h2 id="Why-do-we-need-static-typing"><a href="#Why-do-we-need-static-typing" class="headerlink" title="Why do we need static typing?"></a>Why do we need static typing?</h2><p>From the code above we can see that it does take some effort to write Python with type hints, so why is it preferable anyway? Actually the merits can be drawn from many other statically typed languages like Go and Java:</p>
<ul>
<li>Errors can be found at compile time, or even earlier if you are coding in an IDE.</li>
<li><a target="_blank" rel="noopener" href="https://softwareengineering.stackexchange.com/questions/59606/is-static-typing-worth-the-trade-offs/371369#371369">Studies</a> show that TypeScript or Flow can reduce the number of bugs by 15%.</li>
<li>Static typing can improve the readability and maintainability of the program.</li>
<li>Type hints may have a positive impact on performance.</li>
</ul>
<p>Before we dive into details, let’s differentiate between strong&#x2F;weak typing and static&#x2F;dynamic typing.</p>
<p><img src="/images/python-typing/categories.png" alt="Categories of typing"></p>
<p>Static&#x2F;dynamic typing is easier to tell apart. Static typing validates variable types at compile time, such as Go, Java and C, while dynamic typing checks at runtime, like Python, JavaScript and PHP. Strong&#x2F;weak typing, on the other hand, depends on the extent of implicit conversion. For instance, JavaScript is the least weakly typed language because all types of values can be added to each other. It is the language interpreter that does the implicit conversion, so that number can be added to array, string to object, etc. PHP is another example of weakly typed language, in that string can be added to number, but a warning will be reported. Python, on the contrary, is strongly typed because this operation will immediately raise a <code>TypeError</code>.</p>
<p>Back to the advantages of static typing. For Python, type hints can improve the readability of code. The following snippet defines the function arguments with explicit types, so that the checker would instantly warn you about a wrong call. Besides, type hints are also used by editor to provide informative and accurate autocomplete for invoking methods on an object. Python standard library is fully augmented with type hints, so you can input <code>some_str.</code> and choose from a list of methods of <code>str</code> object.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span>, <span class="type">Optional</span>, NewType</span><br><span class="line"></span><br><span class="line">UserId = NewType(<span class="string">&#x27;UserId&#x27;</span>, <span class="built_in">int</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_request</span>(<span class="params">request_data: <span class="type">Any</span>,</span></span><br><span class="line"><span class="params">                 headers: <span class="type">Optional</span>[<span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="built_in">str</span>]],</span></span><br><span class="line"><span class="params">                 user_id: <span class="type">Optional</span>[UserId] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">                 as_json: <span class="built_in">bool</span> = <span class="literal">True</span></span>):</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<p>For some languages, type hints also boost the performance. Take Clojure for an example:</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">defn</span> <span class="title">len</span> [x]</span><br><span class="line">  (<span class="name">.length</span> x))</span><br><span class="line"></span><br><span class="line">(<span class="keyword">defn</span> <span class="title">len2</span> [^String x]</span><br><span class="line">  (<span class="name">.length</span> x))</span><br><span class="line"></span><br><span class="line">user=&gt; (<span class="name"><span class="built_in">time</span></span> (<span class="name"><span class="built_in">reduce</span></span> + (<span class="name"><span class="built_in">map</span></span> len (<span class="name"><span class="built_in">repeat</span></span> <span class="number">1000000</span> <span class="string">&quot;asdf&quot;</span>))))</span><br><span class="line"><span class="string">&quot;Elapsed time: 3007.198 msecs&quot;</span></span><br><span class="line"><span class="number">4000000</span></span><br><span class="line">user=&gt; (<span class="name"><span class="built_in">time</span></span> (<span class="name"><span class="built_in">reduce</span></span> + (<span class="name"><span class="built_in">map</span></span> len2 (<span class="name"><span class="built_in">repeat</span></span> <span class="number">1000000</span> <span class="string">&quot;asdf&quot;</span>))))</span><br><span class="line"><span class="string">&quot;Elapsed time: 308.045 msecs&quot;</span></span><br><span class="line"><span class="number">4000000</span></span><br></pre></td></tr></table></figure>

<p>The untyped version of <code>len</code> costs about ten times longer. Because Clojure is designed as a dynamically typed language too, and uses reflection to determine the type of variable. This process is rather slow, so type hint works well in performance critical scenarios. But this is not true for Python, because type hints are completely ignored at runtime.</p>
<p>Some other languages also start to adopt static typing. TypeScript, a superset of JavaScript with syntax for types:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">isDone</span>: <span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">decimal</span>: <span class="built_in">number</span> = <span class="number">6</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">color</span>: <span class="built_in">string</span> = <span class="string">&#x27;blue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">listA</span>: <span class="built_in">number</span>[] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">const</span> <span class="attr">listB</span>: <span class="title class_">Array</span>&lt;<span class="built_in">number</span>&gt; = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>): <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>And the Hack programming language, which is PHP with static typing and a lot of new features:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span>hh</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">int</span> MyConst = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">string</span> <span class="variable">$x</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">increment</span>(<span class="params"><span class="keyword">int</span> <span class="variable">$x</span></span>): <span class="title">int</span> </span>&#123;</span><br><span class="line">    <span class="variable">$y</span> = <span class="variable">$x</span> + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$y</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>That being said, whether to adopt static typing for Python depends on the size of your project, or how formal it is. Luckily Python provides a gradual way of adopting static typing, so you do not need to add all type hints in one go. This approach will be discussed in the next section.</p>
<h2 id="Python-static-typing-in-details"><a href="#Python-static-typing-in-details" class="headerlink" title="Python static typing in details"></a>Python static typing in details</h2><h3 id="PEP"><a href="#PEP" class="headerlink" title="PEP"></a>PEP</h3><p>Every new feature in Python comes with a PEP. The PEPs related to static typing can be found in <a target="_blank" rel="noopener" href="https://peps.python.org/topic/typing/">this link</a>. Some of the important ones are:</p>
<ul>
<li>PEP 3107 Function Annotation (Python 3.0)</li>
<li>PEP 484 Type Hints (Python 3.5)</li>
<li>PEP 526 Syntax for Variable Annotations (Python 3.6)</li>
<li>PEP 563 Postponed Evaluation of Annotations (Python 3.7)</li>
<li>PEP 589 TypedDict (Python 3.8)</li>
<li>PEP 585 Type Hinting Generics In Standard Collections (Python 3.9)</li>
<li>PEP 604 Allow writing union types as X | Y (Python 3.10)</li>
</ul>
<p>Python 3.0 introduces the annotation syntax for function arguments and return value, but it was not solely designed for type checking. From Python 3.5, a complete syntax for static typing is defined, <code>typing</code> module is added, and <code>mypy</code> is made the reference implementation for type checking. In later versions, more features are added like protocols, literal types, new callable syntax, etc., making static typing more powerful and delightful to use.</p>
<h3 id="Gradual-typing"><a href="#Gradual-typing" class="headerlink" title="Gradual typing"></a>Gradual typing</h3><p>One thing that never changes is that static typing is an opt-in, meaning you can apply it to the whole project or only some of the modules. As a result, you can progressively add type hints to certain parts of the program, even just a single function. Because in the default setting, mypy will only check functions that have at least one type hint in its signature:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Check</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">greeting</span>(<span class="params">name, age: <span class="built_in">int</span></span>): ...</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">greeting</span>(<span class="params">name, age</span>) -&gt; <span class="built_in">str</span>: ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># Not check</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">greeting</span>(<span class="params">name, age</span>): ...</span><br></pre></td></tr></table></figure>

<p>For untyped argument, like <code>name</code> in the first <code>greeting</code>, it is considered as <code>Any</code> type, which means you can pass any value as <code>name</code>, and use it for any operations. It is different from <code>object</code> type though. Say you define an argument as <code>item: object</code> and try to invoke <code>item.foo()</code>, mypy will complain that <code>object</code> has no attribute <code>foo</code>. So if you are not sure what type of a variable is, give it <code>Any</code> or simply leave it blank.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Check</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">greeting</span>() -&gt; <span class="literal">None</span>: ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># Not check</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">greeting</span>(): ...</span><br></pre></td></tr></table></figure>

<p>Another common mistake is for functions without arguments and return value. We have to add <code>None</code> as the return type, otherwise mypy will silently skip it.</p>
<h3 id="Type-hints"><a href="#Type-hints" class="headerlink" title="Type hints"></a>Type hints</h3><p>There are two ways to compose type hints: annotation and stub file.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Annotation</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DummyList</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.elements: <span class="built_in">list</span>[<span class="built_in">int</span>] = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, element: <span class="built_in">int</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.elements.append(element)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Code without type hints, filename: dummy_list.py</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DummyList</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.elements = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, element</span>):</span><br><span class="line">        self.elements.append(element)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add type hints with stub file, filename: dummy_list.pyi</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DummyList</span>:</span><br><span class="line">    elements: <span class="built_in">list</span>[<span class="built_in">int</span>]</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>: ...</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, element: <span class="built_in">int</span></span>): ...</span><br></pre></td></tr></table></figure>

<p><code>...</code> or <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/constants.html#Ellipsis">Ellipsis</a> is a valid Python expression, and a conventional way to leave out implementation. Stub files are used to add type hints to an existing codebase without changing its source. For instance, Python standard library is fully typed with stub files, hosted in a repository called <a target="_blank" rel="noopener" href="https://github.com/python/typeshed">typeshed</a>. There are other third-party libraries in this repo too, and they are all released as separate packages in PyPI, prefixed with <code>types-</code>, like <code>types-requests</code>. They need to be installed explicitly, otherwise mypy would complain that it cannot find type definitions for these libraries. Fortunately, a lot of popular libraries have embraced static typing and do not require external stub files.</p>
<p>Mypy provides a nice <a target="_blank" rel="noopener" href="https://mypy.readthedocs.io/en/stable/cheat_sheet_py3.html">cheat sheet</a> for basic usage of type hints, and Python <a target="_blank" rel="noopener" href="https://docs.python.org/3.10/library/typing.html">documentation</a> contains the full description. Here are the entries that I find most helpful:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Basic types</span></span><br><span class="line">x: <span class="built_in">int</span> = <span class="number">1</span></span><br><span class="line">x: <span class="built_in">float</span> = <span class="number">1.0</span></span><br><span class="line">x: <span class="built_in">bool</span> = <span class="literal">True</span></span><br><span class="line">x: <span class="built_in">str</span> = <span class="string">&#x27;test&#x27;</span></span><br><span class="line">x: <span class="built_in">bytes</span> = <span class="string">b&#x27;test&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Collection types</span></span><br><span class="line">x: <span class="built_in">tuple</span>[<span class="built_in">int</span>, <span class="built_in">str</span>, <span class="built_in">float</span>] = (<span class="number">3</span>, <span class="string">&#x27;yes&#x27;</span>, <span class="number">7.5</span>)</span><br><span class="line">x: <span class="built_in">list</span>[<span class="built_in">int</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">x: <span class="built_in">set</span>[<span class="built_in">int</span>] = &#123;<span class="number">6</span>, <span class="number">7</span>&#125;</span><br><span class="line">x: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="built_in">float</span>] = &#123;<span class="string">&#x27;field&#x27;</span>, <span class="number">2.0</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Special types</span></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span>, <span class="type">Union</span>, <span class="type">Optional</span>, <span class="type">Callable</span></span><br><span class="line"></span><br><span class="line">x: <span class="type">Any</span> = <span class="number">1</span></span><br><span class="line">x = <span class="string">&#x27;test&#x27;</span></span><br><span class="line"></span><br><span class="line">x: <span class="built_in">int</span> | <span class="built_in">str</span> = <span class="number">1</span>  <span class="comment"># Equivalent to x: Union[int, str]</span></span><br><span class="line">x = <span class="string">&#x27;test&#x27;</span></span><br><span class="line"></span><br><span class="line">x: <span class="type">Optional</span>[<span class="built_in">str</span>] = some_function()</span><br><span class="line">x.lower()  <span class="comment"># Error: Optional[str] has no attribute lower</span></span><br><span class="line"><span class="keyword">if</span> x <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">    x.lower()  <span class="comment"># OK</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">num1: <span class="built_in">int</span>, my_float: <span class="built_in">float</span> = <span class="number">3.5</span></span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">    <span class="keyword">return</span> num1 + my_float</span><br><span class="line">x: <span class="type">Callable</span>[[<span class="built_in">int</span>, <span class="built_in">float</span>], <span class="built_in">float</span>] = f</span><br></pre></td></tr></table></figure>

<p>One of my favorite types is <code>Optional</code>, since it solves the problem of <code>None</code>. Mypy will raise an error if you fail to guard against a nullable variable. <code>if x is not None</code> is also a way of <a target="_blank" rel="noopener" href="https://mypy.readthedocs.io/en/stable/type_narrowing.html">type narrowing</a>, meaning mypy will consider <code>x</code> as <code>str</code> in the <code>if</code> block. Another useful type narrowing technique is <code>isinstance</code>.</p>
<p>Python classes are also types. Mypy understands inheritance, and class types can be used in collections, too.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span>(<span class="title class_ inherited__">Animal</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">animal: Animal = Cat()</span><br><span class="line">cats: <span class="built_in">list</span>[Cat] = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># Type alias</span></span><br><span class="line">CatList = <span class="built_in">list</span>[Cat]</span><br><span class="line">cats: CatList = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># Forward reference</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>(<span class="title class_ inherited__">Animal</span>):</span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create</span>() -&gt; <span class="string">&#x27;Dog&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> Dog()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_list</span>() -&gt; <span class="built_in">list</span>[<span class="string">&#x27;Dog&#x27;</span>]:</span><br><span class="line">        <span class="keyword">return</span> []</span><br></pre></td></tr></table></figure>

<p>Type alias is useful for shortening the type definition. And notice the quotes around <code>Dog</code>. It is called forward reference, that allows you to refer to a type that has not yet been fully defined. In a future version, possibly Python 3.12, the quotes may be omitted.</p>
<p>Another useful utility from <code>typing</code> module is <code>TypedDict</code>. <code>dict</code> is a frequently used data structure in Python, so it would be nice to explicitly define the fields and types in it.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> TypedDict</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    x: <span class="built_in">int</span></span><br><span class="line">    y: <span class="built_in">int</span></span><br><span class="line"></span><br><span class="line">p1: Point = &#123;<span class="string">&#x27;x&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;y&#x27;</span>: <span class="number">2</span>&#125;</span><br><span class="line">p2 = Point(x=<span class="number">1</span>, y=<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p><code>TypedDict</code> is like a regular <code>dict</code> at runtime, only the type checker would see the difference. Another option is to use Python <a target="_blank" rel="noopener" href="https://docs.python.org/3.10/library/dataclasses.html">dataclass</a> to define DTO (Data Transfer Object). Mypy has <a target="_blank" rel="noopener" href="https://mypy.readthedocs.io/en/stable/additional_features.html#dataclasses">full support</a> for it, too.</p>
<h2 id="Advanced-features"><a href="#Advanced-features" class="headerlink" title="Advanced features"></a>Advanced features</h2><h3 id="Generics"><a href="#Generics" class="headerlink" title="Generics"></a>Generics</h3><p><code>list</code> is a generic class, and the <code>str</code> in <code>list[str]</code> is called a type parameter. So generics are useful when the class is a kind of container, and does not care about the type of elements it contains. We can easily write a generic class on our own. Say we want to wrap a variable of arbitrary type and log a message when its value is changed.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> TypeVar, <span class="type">Generic</span></span><br><span class="line"></span><br><span class="line">T = TypeVar(<span class="string">&#x27;T&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoggedVar</span>(<span class="type">Generic</span>[T]):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, value: T</span>):</span><br><span class="line">        self.value = value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set</span>(<span class="params">self, new: T</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;Set value to <span class="subst">&#123;new&#125;</span>, previous value is <span class="subst">&#123;self.value&#125;</span>&#x27;</span>)</span><br><span class="line">        self.value = new</span><br><span class="line"></span><br><span class="line">v = LoggedVar[<span class="built_in">int</span>](<span class="number">1</span>)</span><br><span class="line">v.<span class="built_in">set</span>(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>We can define functions that deal with generic classes. For instance, to return the first element of any sequence-like data structure:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> TypeVar</span><br><span class="line"><span class="keyword">from</span> collections.abc <span class="keyword">import</span> <span class="type">Sequence</span></span><br><span class="line"></span><br><span class="line">T = TypeVar(<span class="string">&#x27;T&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">first</span>(<span class="params">seq: <span class="type">Sequence</span>[T]</span>) -&gt; T:</span><br><span class="line">    <span class="keyword">return</span> seq[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(first([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]))</span><br><span class="line"><span class="built_in">print</span>(first(<span class="string">&#x27;abc&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p><code>Sequence</code> is an abstract base class, which we will discuss in the next section. <code>list</code> and <code>str</code> are both subclasses of <code>Sequence</code>, so they can be accepted by the function <code>first</code>.</p>
<p>Type parameter can also have a bound, meaning it must be a subclass of a particular type:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> TypeVar</span><br><span class="line"><span class="keyword">from</span> collections.abc <span class="keyword">import</span> Sized</span><br><span class="line"></span><br><span class="line">T = TypeVar(<span class="string">&#x27;T&#x27;</span>, bound=Sized)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">longer</span>(<span class="params">x: T, y: T</span>) -&gt; T:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(x) &gt; <span class="built_in">len</span>(y):</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line">    <span class="keyword">return</span> y</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(longer([<span class="number">1</span>], [<span class="number">1</span>, <span class="number">2</span>]))</span><br><span class="line"><span class="built_in">print</span>(longer([<span class="number">1</span>], &#123;<span class="number">1</span>, <span class="number">2</span>&#125;))</span><br><span class="line"><span class="built_in">print</span>(longer([<span class="number">1</span>], <span class="string">&#x27;ab&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p><code>list</code>, <code>set</code>, and <code>str</code> are all subclasses of <code>Sized</code>, in that they all have a <code>__len__</code> method, so they can be passed to <code>longer</code> and <code>len</code> without problem.</p>
<h3 id="Abstract-base-class"><a href="#Abstract-base-class" class="headerlink" title="Abstract base class"></a>Abstract base class</h3><p><code>Sequence</code> and <code>Sized</code> are both abstract base classes, or ABC. As the name indicates, the class contains abstract methods and is supposed to be inherited from. There are plenty of predefined collection ABCs in <a target="_blank" rel="noopener" href="https://docs.python.org/3.10/library/collections.abc.html">collections.abc</a> module, and they form a hierarchy of collection types in Python:</p>
<p><img src="/images/python-typing/collection-types.png" alt="Python collection types"></p>
<p>Mypy understands ABC, so it is a good practice to declare function arguments with a more general type like <code>Iterable[int]</code>, so that both <code>list[int]</code> and <code>set[int]</code> are acceptable. To write a custom class that behaves like <code>Iterable</code>, subclass it and provide the required methods.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections.abc <span class="keyword">import</span> Sized, Iterable, Iterator</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bucket</span>(Sized, Iterable[<span class="built_in">int</span>]):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>) -&gt; Iterator[<span class="built_in">int</span>]:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">iter</span>([])</span><br><span class="line"></span><br><span class="line">bucket: Iterable[<span class="built_in">int</span>] = Bucket()</span><br></pre></td></tr></table></figure>

<h3 id="Duck-typing"><a href="#Duck-typing" class="headerlink" title="Duck typing"></a>Duck typing</h3><p>In the previous code listing, what if I remove the base class:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Bucket</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>) -&gt; Iterator[<span class="built_in">int</span>]:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">iter</span>([])</span><br><span class="line"></span><br><span class="line">bucket: Iterable[<span class="built_in">int</span>] = Bucket()  <span class="comment"># Error?</span></span><br></pre></td></tr></table></figure>

<p>Is the class instance still assignable to <code>Iterable[int]</code>? The answer is yes, because <code>Bucket</code> class would behave like an <code>Iterable[int]</code>, in that it contains a method <code>__iter__</code> and its return value is of correct type. It is called duck typing: If it walks like a duck and quacks like a duck, then it must be a duck. Duck typing only works for simple ABCs, like <code>Iterable</code>, <code>Collection</code>. In Python, there is a dedicated name for this feature, <a target="_blank" rel="noopener" href="https://docs.python.org/3.10/library/typing.html#typing.Protocol">Protocol</a>. Simply put, if the class defines required methods, mypy would consider it as the corresponding type.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sized</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>) -&gt; <span class="built_in">int</span>: ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># Container[T]</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__contains__</span>(<span class="params">self, x: <span class="built_in">object</span></span>) -&gt; <span class="built_in">bool</span>: ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># Collection[T]</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>) -&gt; <span class="built_in">int</span>: ...</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>) -&gt; Iterator[T]: ...</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__contains__</span>(<span class="params">self, x: <span class="built_in">object</span></span>) -&gt; <span class="built_in">bool</span>: ...</span><br></pre></td></tr></table></figure>

<p>It is also possible to define your own Protocol:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Protocol</span><br><span class="line"><span class="keyword">from</span> collections.abc <span class="keyword">import</span> Iterable</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Closeable</span>(<span class="title class_ inherited__">Protocol</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">close</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>: ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Resource</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">close</span>(<span class="params">self</span>):</span><br><span class="line">        self.file.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">close_all</span>(<span class="params">resources: Iterable[Closeable]</span>):</span><br><span class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> resources:</span><br><span class="line">        r.close()</span><br><span class="line"></span><br><span class="line">close_all([Resource()])  <span class="comment"># OK</span></span><br></pre></td></tr></table></figure>

<h3 id="Runtime-validation"><a href="#Runtime-validation" class="headerlink" title="Runtime validation"></a>Runtime validation</h3><p>Type hints are mostly used in static type check, and do not work at runtime. To check variable types at runtime, we can either write code on our own, i.e. <code>isinstance</code>, or use third-party libraries. Two popular choices are <a target="_blank" rel="noopener" href="https://github.com/agronholm/typeguard">typeguard</a>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typeguard <span class="keyword">import</span> typechecked</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>: ...</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span>(<span class="title class_ inherited__">Animal</span>): ...</span><br><span class="line"></span><br><span class="line"><span class="meta">@typechecked</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">some_function</span>(<span class="params">animals: <span class="type">Sequence</span>[Animal]</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">some_function([<span class="number">1</span>])</span><br><span class="line"><span class="comment"># TypeCheckError: item 0 of argument &quot;animals&quot; (list) is not an instance of Animal</span></span><br></pre></td></tr></table></figure>

<p>And <a target="_blank" rel="noopener" href="https://github.com/pydantic/pydantic">pydantic</a>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    x: <span class="built_in">float</span></span><br><span class="line">    y: <span class="built_in">float</span></span><br><span class="line"></span><br><span class="line">p = Point(x=<span class="string">&#x27;1.23&#x27;</span>, y=<span class="string">&#x27;abc&#x27;</span>)</span><br><span class="line"><span class="comment"># ValidationError: 1 validation error for Point y</span></span><br><span class="line"><span class="comment"># Input should be a valid number, unable to parse string as a number</span></span><br></pre></td></tr></table></figure>


<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://docs.python.org/3.10/library/typing.html">https://docs.python.org/3.10/library/typing.html</a></li>
<li><a target="_blank" rel="noopener" href="https://mypy.readthedocs.io/en/stable/index.html">https://mypy.readthedocs.io/en/stable/index.html</a></li>
<li><a target="_blank" rel="noopener" href="https://typing.readthedocs.io/en/latest/">https://typing.readthedocs.io/en/latest/</a></li>
<li><a target="_blank" rel="noopener" href="https://wphomes.soic.indiana.edu/jsiek/what-is-gradual-typing/">https://wphomes.soic.indiana.edu/jsiek/what-is-gradual-typing/</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.zulip.com/2016/10/13/static-types-in-python-oh-mypy/">https://blog.zulip.com/2016/10/13/static-types-in-python-oh-mypy/</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://shzhangji.com/blog/2024/01/19/python-static-type-check/" data-id="clu6akwjw009wfdq3fs8idm55" data-title="Python Static Type Check" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
        <a href="https://shzhangji.com/blog/2024/01/19/python-static-type-check/#disqus_thread" class="article-comment-link"><span class="fa fa-comment">Comments</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mypy/" rel="tag">mypy</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/blog/2024/01/28/define-api-data-models-with-pydantic/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Define API Data Models with Pydantic
        
      </div>
    </a>
  
  
    <a href="/blog/2024/01/05/migrate-from-pip-requirements-txt-to-poetry/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Migrate from Pip requirements.txt to Poetry</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/algorithm/" style="font-size: 10px;">algorithm</a> <a href="/tags/analytics/" style="font-size: 14.29px;">analytics</a> <a href="/tags/apache-beam/" style="font-size: 10px;">apache beam</a> <a href="/tags/bootstrap/" style="font-size: 10px;">bootstrap</a> <a href="/tags/canal/" style="font-size: 10px;">canal</a> <a href="/tags/ci/" style="font-size: 10px;">ci</a> <a href="/tags/clojure/" style="font-size: 10px;">clojure</a> <a href="/tags/connect/" style="font-size: 10px;">connect</a> <a href="/tags/crossfilter/" style="font-size: 10px;">crossfilter</a> <a href="/tags/dc-js/" style="font-size: 10px;">dc.js</a> <a href="/tags/devops/" style="font-size: 10px;">devops</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/eclipse/" style="font-size: 10px;">eclipse</a> <a href="/tags/elasticsearch/" style="font-size: 10px;">elasticsearch</a> <a href="/tags/es6/" style="font-size: 10px;">es6</a> <a href="/tags/eslint/" style="font-size: 11.43px;">eslint</a> <a href="/tags/etl/" style="font-size: 12.86px;">etl</a> <a href="/tags/flask/" style="font-size: 14.29px;">flask</a> <a href="/tags/flink/" style="font-size: 12.86px;">flink</a> <a href="/tags/flume/" style="font-size: 12.86px;">flume</a> <a href="/tags/frontend/" style="font-size: 17.14px;">frontend</a> <a href="/tags/functional-programming/" style="font-size: 10px;">functional programming</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/github/" style="font-size: 11.43px;">github</a> <a href="/tags/guice/" style="font-size: 10px;">guice</a> <a href="/tags/hadoop/" style="font-size: 10px;">hadoop</a> <a href="/tags/hbase/" style="font-size: 10px;">hbase</a> <a href="/tags/hdfs/" style="font-size: 11.43px;">hdfs</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/hive/" style="font-size: 11.43px;">hive</a> <a href="/tags/java/" style="font-size: 18.57px;">java</a> <a href="/tags/javascript/" style="font-size: 15.71px;">javascript</a> <a href="/tags/kafka/" style="font-size: 11.43px;">kafka</a> <a href="/tags/kubernetes/" style="font-size: 11.43px;">kubernetes</a> <a href="/tags/lodash/" style="font-size: 11.43px;">lodash</a> <a href="/tags/machine-learning/" style="font-size: 10px;">machine learning</a> <a href="/tags/mapreduce/" style="font-size: 10px;">mapreduce</a> <a href="/tags/mypy/" style="font-size: 10px;">mypy</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/openapi/" style="font-size: 11.43px;">openapi</a> <a href="/tags/ops/" style="font-size: 10px;">ops</a> <a href="/tags/pandas/" style="font-size: 11.43px;">pandas</a> <a href="/tags/parcel/" style="font-size: 10px;">parcel</a> <a href="/tags/pinia/" style="font-size: 10px;">pinia</a> <a href="/tags/pip/" style="font-size: 10px;">pip</a> <a href="/tags/poetry/" style="font-size: 10px;">poetry</a> <a href="/tags/prometheus/" style="font-size: 10px;">prometheus</a> <a href="/tags/pydantic/" style="font-size: 10px;">pydantic</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/react/" style="font-size: 10px;">react</a> <a href="/tags/restful/" style="font-size: 11.43px;">restful</a> <a href="/tags/scala/" style="font-size: 11.43px;">scala</a> <a href="/tags/scalatra/" style="font-size: 10px;">scalatra</a> <a href="/tags/source-code/" style="font-size: 10px;">source code</a> <a href="/tags/spark/" style="font-size: 14.29px;">spark</a> <a href="/tags/spark-streaming/" style="font-size: 10px;">spark streaming</a> <a href="/tags/spring/" style="font-size: 12.86px;">spring</a> <a href="/tags/spring-boot/" style="font-size: 11.43px;">spring boot</a> <a href="/tags/spring-security/" style="font-size: 10px;">spring security</a> <a href="/tags/sql/" style="font-size: 11.43px;">sql</a> <a href="/tags/sqlalchemy/" style="font-size: 11.43px;">sqlalchemy</a> <a href="/tags/stream-processing/" style="font-size: 12.86px;">stream processing</a> <a href="/tags/tensorflow/" style="font-size: 10px;">tensorflow</a> <a href="/tags/thrift/" style="font-size: 10px;">thrift</a> <a href="/tags/typescript/" style="font-size: 12.86px;">typescript</a> <a href="/tags/vite/" style="font-size: 10px;">vite</a> <a href="/tags/vue/" style="font-size: 15.71px;">vue</a> <a href="/tags/vuex/" style="font-size: 10px;">vuex</a> <a href="/tags/webjars/" style="font-size: 10px;">webjars</a> <a href="/tags/webpack/" style="font-size: 10px;">webpack</a> <a href="/tags/websocket/" style="font-size: 10px;">websocket</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">February 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">January 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">April 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">October 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">April 2013</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/2024/02/07/dependency-injection-in-flink/">Dependency Injection in Flink</a>
          </li>
        
          <li>
            <a href="/blog/2024/01/28/define-api-data-models-with-pydantic/">Define API Data Models with Pydantic</a>
          </li>
        
          <li>
            <a href="/blog/2024/01/19/python-static-type-check/">Python Static Type Check</a>
          </li>
        
          <li>
            <a href="/blog/2024/01/05/migrate-from-pip-requirements-txt-to-poetry/">Migrate from Pip requirements.txt to Poetry</a>
          </li>
        
          <li>
            <a href="/blog/2023/02/13/setup-ci-with-github-actions-java-node-python/">Setup CI with GitHub Actions (Java/Node/Python)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
        <p xmlns:cc="http://creativecommons.org/ns#" >This work is licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY-NC-SA 4.0<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nc.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1"></a></p>
      
      &copy; 2024 Ji Zhang (Jerry)<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/categories/Big-Data" class="mobile-nav-link">Big Data</a>
  
    <a href="/categories/Programming" class="mobile-nav-link">Programming</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'jizhang';
  
  var disqus_url = 'https://shzhangji.com/blog/2024/01/19/python-static-type-check/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>



<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>